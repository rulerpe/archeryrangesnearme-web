---
import BaseLayout from '../layouts/BaseLayout.astro';
import { parseRanges, getStateSlug } from '../data/ranges';
import { makeTitle, makeDescription } from '../utils/seo';

const ranges = parseRanges();
const stateCounts = new Map<string, { name: string; slug: string; count: number }>();

for (const r of ranges) {
  const slug = getStateSlug(r.state);
  if (!stateCounts.has(slug)) {
    stateCounts.set(slug, { name: r.state, slug, count: 0 });
  }
  stateCounts.get(slug)!.count++;
}

const states = [...stateCounts.values()].sort((a, b) => a.name.localeCompare(b.name));

const schema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Archery Ranges Near Me',
  url: Astro.site?.toString(),
  description: makeDescription('home', {}),
};
---

<BaseLayout
  title={makeTitle('home', {})}
  description={makeDescription('home', {})}
>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />

  <div class="py-6 sm:py-10">
    <h1 class="font-display text-4xl sm:text-5xl font-bold text-ink leading-tight mb-4">
      Find Archery Ranges<br class="hidden sm:block" /> Near You
    </h1>
    <p class="text-stone text-lg mb-12 max-w-xl">
      Browse {ranges.length.toLocaleString()} archery ranges across the United States.
    </p>

    <h2 class="font-display text-2xl font-semibold text-ink mb-6">Browse by State</h2>
    <ul class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
      {states.map(s => (
        <li>
          <a
            href={`/archery-ranges/${s.slug}/`}
            class="group block bg-cream-dark border border-tan rounded-xl p-4 hover:border-forest hover:shadow-sm transition-all"
          >
            <span class="font-display font-semibold text-forest text-sm block leading-snug group-hover:text-forest-dark">
              {s.name}
            </span>
            <span class="text-xs text-stone mt-1 block">{s.count} ranges</span>
            <span class="text-amber text-sm mt-1 inline-block group-hover:translate-x-0.5 transition-transform">â†’</span>
          </a>
        </li>
      ))}
    </ul>
  </div>
</BaseLayout>
