---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import ListingCard from '../../components/ListingCard.astro';
import { parseRanges } from '../../data/ranges';
import { FEATURES, filterByFeature, getFeatureLabel } from '../../data/filters';
import { makeTitle, makeDescription } from '../../utils/seo';

export async function getStaticPaths() {
  return FEATURES.map(f => ({
    params: { feature: f.slug },
    props: { featureSlug: f.slug },
  }));
}

const { feature: featureSlug } = Astro.params;
const { featureSlug: _slug } = Astro.props;
const ranges = filterByFeature(parseRanges(), featureSlug);
const featureLabel = getFeatureLabel(featureSlug);
const schema = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: makeTitle('feature', { featureLabel }),
  description: makeDescription('feature', { featureLabel }),
  url: new URL(`/archery-ranges/${featureSlug}/`, Astro.site).toString(),
};
---

<BaseLayout
  title={makeTitle('feature', { featureLabel })}
  description={makeDescription('feature', { featureLabel })}
>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
  <Breadcrumbs crumbs={[{ label: featureLabel }]} />

  <h1>{featureLabel} Archery Ranges</h1>
  <p>{ranges.length} ranges nationwide.</p>

  {ranges.map(r => <ListingCard range={r} />)}
</BaseLayout>
